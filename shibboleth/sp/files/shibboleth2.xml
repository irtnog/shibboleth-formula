{%- from "shibboleth/sp/map.jinja" import shibsp_settings with context -%}
<SPConfig{{ {
    'xmlns': 'urn:mace:shibboleth:2.0:native:sp:config',
    'xmlns:conf': 'urn:mace:shibboleth:2.0:native:sp:config',
    'xmlns:saml': 'urn:oasis:names:tc:SAML:2.0:assertion',
    'xmlns:samlp': 'urn:oasis:names:tc:SAML:2.0:protocol',
    'xmlns:md': 'urn:oasis:names:tc:SAML:2.0:metadata',
    'logger': shibsp_settings['logger'],
    'clockSkew': shibsp_settings['clock_skew'],
    'unsafeChars': shibsp_settings['unsafe_chars'],
    'allowedSchemes': shibsp_settings['allowed_schemes'],
    'langFromClient':
      None if shibsp_settings['lang_from_client'] == None else
      'true' if shibsp_settings['lang_from_client'] else
      'false',
    'langPriority':
      shibsp_settings['lang_priority']|join(' ') or
      None,
  }|xmlattr }}>

    <!--
    By default, in-memory StorageService, ReplayCache, ArtifactMap, and SessionCache
    are used. See example-shibboleth2.xml for samples of explicitly configuring them.
    -->

    <!--
    To customize behavior for specific resources on Apache, and to link vhosts or
    resources to ApplicationOverride settings below, use web server options/commands.
    See https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPConfigurationElements for help.
    
    For examples with the RequestMap XML syntax instead, see the example-shibboleth2.xml
    file, and the https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPRequestMapHowTo topic.
    -->

    <!-- The ApplicationDefaults element is where most of Shibboleth's SAML bits are defined. -->
{{  generate_application_settings(
      shibsp_settings.entity_id,
      app_overrides=shibsp_settings.app_overrides,
      artifact_by_filesystem=shibsp_settings.artifact_by_filesystem,
      async_logout=shibsp_settings.async_logout,
      attribute_map=shibsp_settings.attribute_map,
      attribute_policy=shibsp_settings.attribute_policy,
      attribute_resolver=shibsp_settings.attribute_resolver,
      auth_context_comparison=shibsp_settings.auth_context_comparison,
      auth_password=shibsp_settings.auth_password,
      auth_type=shibsp_settings.auth_type,
      auth_username=shibsp_settings.auth_username,
      authn_context_classes=shibsp_settings.authn_context_classes,
      backchannel_cipher_suites=shibsp_settings.backchannel_cipher_suites,
      backchannel_connect_timeout=shibsp_settings.backchannel_connect_timeout,
      backchannel_operation_timeout=shibsp_settings.backchannel_operation_timeout,
      backchannel_require_encryption=shibsp_settings.backchannel_require_encryption,
      backchannel_require_transport_auth=shibsp_settings.backchannel_require_transport_auth,
      chunked_encoding=shibsp_settings.chunked_encoding,
      digest_algorithm=shibsp_settings.digest_algorithm,
      ecp_enabled=shibsp_settings.ecp_enabled,
      encryption=shibsp_settings.encryption,
      encryption_algorithm=shibsp_settings.encryption_algorithm,
      help_location=shibsp_settings.help_location,
      metadata_providers=shibsp_settings.metadata_providers,
      relying_parties=shibsp_settings.relying_parties,
      remote_user=shibsp_settings.remote_user,
      require_signed_assertions=shibsp_settings.require_signed_assertions,
      session_check_address=shibsp_settings.session_check_address,
      session_cookie_properties=shibsp_settings.session_cookie_properties,
      session_handler_ssl=shibsp_settings.session_handler_ssl,
      session_handlers=shibsp_settings.session_handlers,
      session_hook=shibsp_settings.session_hook,
      session_idp_history=shibsp_settings.session_idp_history,
      session_lifetime=shibsp_settings.session_lifetime,
      session_logout=shibsp_settings.session_logout,
      session_relay_state=shibsp_settings.session_relay_state,
      session_sso=shibsp_settings.session_sso,
      session_timeout=shibsp_settings.session_timeout,
      signing=shibsp_settings.signing,
      signing_algorithm=shibsp_settings.signing_algorithm,
      sp_name_qualifier=shibsp_settings.sp_name_qualifier,
      sso_default_idp=shibsp_settings.sso_default_idp,
      sso_discovery_protocol=shibsp_settings.sso_discovery_protocol,
      style_sheet=shibsp_settings.style_sheet,
      support_contact=shibsp_settings.support_contact,
   ) }}
    
    <!-- Policies that determine how to process and authenticate runtime messages. -->
    <SecurityPolicyProvider type="XML" validate="true" path="security-policy.xml"/>

    <!-- Low-level configuration about protocols and bindings available for use. -->
    <ProtocolProvider type="XML" validate="true" reloadChanges="false" path="protocols.xml"/>

</SPConfig>
